id: "response-node-test-1"
name: "Response Node Test Workflow"
content:
  name: "Response Node Test Workflow"
  global:
    apiKey: "test-secret-123"
    greeting: "Hello from Response Node"

  nodes:
    # 1. HTTP Gateway 触发器 - 监听外部请求
    - name: "GatewayReceiver"
      type: "http_gateway"
      parameters:
        http_port: "8080"
        routes: "GET:/api/hello,POST:/api/echo"
        api_key: "={{ $global.apiKey }}"

    # 2. 解析请求
    - name: "ParseRequest"
      type: "js"
      parameters:
        input: "={{ $global.TRIGGER.payload }}"
        code: |
          const payload = input;
          console.log("Request received:", JSON.stringify(payload, null, 2));
          
          return {
            method: payload.method || '',
            path: payload.path || '',
            body: payload.body || {},
            query: payload.query || {}
          };

    # 3. 处理 GET 请求
    - name: "HandleGetRequest"
      type: "js"
      parameters:
        input: "={{ $P }}"
        code: |
          const request = input;
          return {
            message: `{{ $global.greeting }}`,
            method: request.method,
            path: request.path,
            timestamp: new Date().toISOString()
          };

    # 4. 处理 POST 请求
    - name: "HandlePostRequest"
      type: "js"
      parameters:
        input: "={{ $P }}"
        code: |
          const request = input;
          return {
            message: `Echo: ${JSON.stringify(request.body)}`,
            received: request.body,
            timestamp: new Date().toISOString()
          };

    # 5. GET 响应节点 - 返回同步响应
    - name: "GetResponse"
      type: "response"
      parameters:
        status_code: "200"
        body: |
          {
            "success": true,
            "data": {{ $P }},
            "metadata": {
              "workflow": "{{ $WORKFLOW.name }}",
              "node": "{{ $NODE.name }}"
            }
          }
        headers:
          Content-Type: "application/json"
          X-Response-From: "workflow-response-node"

    # 6. POST 响应节点 - 返回同步响应  
    - name: "PostResponse"
      type: "response"
      parameters:
        status_code: "201"
        body: |
          {
            "success": true,
            "echo": {{ $P }},
            "metadata": {
              "workflow": "{{ $WORKFLOW.name }}",
              "node": "{{ $NODE.name }}"
            }
          }
        headers:
          Content-Type: "application/json"
          X-Response-From: "workflow-response-node"
          X-Status: "created"

  connections:
    GatewayReceiver:
      - - { node: "ParseRequest" }
    ParseRequest:
      - - { node: "HandleGetRequest", when: [{ value1: "={{ $P.method }}", operation: "==", value2: "GET" }] }
      - - { node: "HandlePostRequest", when: [{ value1: "={{ $P.method }}", operation: "==", value2: "POST" }] }
    HandleGetRequest:
      - - { node: "GetResponse" }
    HandlePostRequest:
      - - { node: "PostResponse" }
updatedAt: "2025-12-11T00:00:00.000Z"